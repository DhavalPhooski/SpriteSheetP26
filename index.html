<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Spritesheet Demo - Gyro Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .HeroSection {
            width: 100%;
            height: 100vh;
            position: relative;
            background: linear-gradient(to bottom, #3C2A56, #F4A27E);
            overflow: hidden;
        }

        /* Base sprite class with performance optimizations */
        .sprite {
            display: block;
            position: absolute;
            background-image: url('SpriteSheet.svg');
            background-repeat: no-repeat;
            will-change: transform;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* Individual sprite positions */
        .sprite-title {
            left: 50%;
            width: 2100px;
            height: 425px;
            background-position: 0 0;
            transform: translateX(-50%) scale(0.5);
            z-index: 50;
        }

        .sprite-base-clouds {
            bottom: 0;
            left: 0;
            width: 1525px;
            height: 425px;
            background-position: -2100px 0;
            transform: scale(1.7);
            z-index: 200;
        }

        .WaterMillParent {
            right: 0;
            bottom: 0;
            position: absolute;
            width: 600px;
            height: 600px;
            transform: scale(0.8);
            z-index: 100;
        }

        .sprite-rotating-watermill1 {
            position: absolute;
            left: -16%;
            bottom: 0;
            width: 699px;
            height: 450px;
            background-position: -831px -425px;
            z-index: 80;
            transform-origin: 46.5% 52%;
            animation: rotate 10s linear infinite;
        }

        .sprite-rotating-watermill2 {
            position: absolute;
            left: -3%;
            bottom: -1%;
            width: 570px;
            height: 450px;
            background-position: -1530px -425px;
            z-index: 90;
            animation: rotate2 11s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotateZ(0deg) scale(0.9); }
            to { transform: rotateZ(-360deg) scale(0.9); }
        }

        @keyframes rotate2 {
            from { transform: rotateZ(0deg) scale(0.7); }
            to { transform: rotateZ(-360deg) scale(0.7); }
        }

        .sprite-static-watermill {
            position: absolute;
            right: -30%;
            bottom: -30%;
            width: 831px;
            height: 949px;
            background-position: 0 -875px;
            transform: scale(0.7);
            z-index: 100;
        }

        .WindMillParent {
            left: 0;
            top: 15%;
            position: absolute;
            width: 600px;
            height: 600px;
            z-index: 100;
            transform: scale(1.2);
        }

        .sprite-rotating-windmill {
            position: absolute;
            left: 10%;
            top: -8%;
            width: 470px;
            height: 450px;
            transform-origin: 52% 50%;
            background-position: 0 -425px;
            animation: rotate2 11s linear infinite;
        }

        .sprite-static-windmill {
            position: absolute;
            transform: scale(0.5);
            bottom: -40%;
            left: -8%;
            width: 699px;
            height: 949px;
            background-position: -831px -875px;
        }

        .sprite-title-cloud1 {
            width: 470px;
            height: 739px;
            background-position: 0 -2050px;
            opacity: 0;
        }

        .sprite-title-cloud2 {
            width: 1269px;
            height: 739px;
            background-position: -831px -2050px;
            opacity: 0;
        }

        .sprite-stars {
            position: absolute;
            top: -20%;
            width: 1952px;
            height: 450px;
            background-position: -2100px -425px;
            z-index: 10;
        }

        .sprite-geometric-circle-grid {
            width: 1952px;
            height: 1394px;
            background-position: -2100px -1395px;
            z-index: 10;
            left: -5%;
        }

        .sprite-babbage-machine {
            position: absolute;
            left: 50%;
            bottom: -15%;
            width: 1269px;
            height: 739px;
            background-position: -831px -2050px;
            transform: translateX(-50%) scale(0.5);
            z-index: 100;
        }

        /* Preload hint */
        body::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            background-image: url('SpriteSheet.svg');
        }

        /* Gyro activation prompt */
        .gyro-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 14px;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .gyro-prompt:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: translateX(-50%) scale(1.05);
        }

        .gyro-prompt.visible {
            display: block;
        }
    </style>
</head>

<body>
    <section class="HeroSection" id="heroSection">
        <div class="sprite sprite-title" data-speed="0.3"></div>
        <div class="sprite sprite-base-clouds" data-speed="0.1"></div>

        <div class="WaterMillParent" data-speed="0.6">
            <div class="sprite sprite-rotating-watermill1"></div>
            <div class="sprite sprite-rotating-watermill2"></div>
            <div class="sprite sprite-static-watermill"></div>
        </div>

        <div class="WindMillParent" data-speed="0.7">
            <div class="sprite sprite-rotating-windmill"></div>
            <div class="sprite sprite-static-windmill"></div>
        </div>

        <div class="sprite sprite-stars" data-speed="0.2"></div>
        <div class="sprite sprite-geometric-circle-grid" data-speed="0.15"></div>
        <div class="sprite sprite-babbage-machine" data-speed="0.5"></div>
    </section>

    <div class="gyro-prompt" id="gyroPrompt">
        üì± Tap to enable gyroscope parallax
    </div>

    <script>
        // Optimized parallax effect with mouse and gyroscope support
        const heroSection = document.getElementById('heroSection');
        const parallaxElements = document.querySelectorAll('[data-speed]');
        const gyroPrompt = document.getElementById('gyroPrompt');
        
        let targetX = 0;      // Target position (-1 to 1)
        let currentX = 0;     // Current position
        let velocity = 0;     // Velocity for gyro-based acceleration
        let rafId = null;
        let isGyroActive = false;
        let gyroPermissionGranted = false;

        // Mouse parallax handler
        heroSection.addEventListener('mousemove', (e) => {
            if (!isGyroActive) {
                const rect = heroSection.getBoundingClientRect();
                targetX = ((e.clientX - rect.left) / rect.width - 0.5) * 2;
            }
        });

        heroSection.addEventListener('mouseleave', () => {
            if (!isGyroActive) {
                targetX = 0;
            }
        });

        // Detect if device likely has gyroscope
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (isMobile && window.DeviceOrientationEvent) {
            // Check if permission is needed (iOS 13+)
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                gyroPrompt.classList.add('visible');
                
                gyroPrompt.addEventListener('click', async () => {
                    try {
                        const permission = await DeviceOrientationEvent.requestPermission();
                        if (permission === 'granted') {
                            gyroPermissionGranted = true;
                            initGyro();
                            gyroPrompt.style.display = 'none';
                        }
                    } catch (error) {
                        console.log('Gyroscope permission denied:', error);
                        gyroPrompt.textContent = '‚ùå Gyroscope access denied';
                        setTimeout(() => {
                            gyroPrompt.style.display = 'none';
                        }, 2000);
                    }
                });
            } else {
                // Non-iOS devices - auto-init
                initGyro();
            }
        }

        function initGyro() {
            window.addEventListener('deviceorientation', handleOrientation);
            
            // Show confirmation on mobile
            if (isMobile && !gyroPermissionGranted) {
                gyroPrompt.textContent = '‚úì Gyroscope active!';
                gyroPrompt.classList.add('visible');
                setTimeout(() => {
                    gyroPrompt.style.display = 'none';
                }, 2000);
            }
        }

        function handleOrientation(event) {
            // Use gamma (left-right tilt) for parallax
            // gamma ranges from -90 to 90 (left to right)
            const gamma = event.gamma;
            
            if (gamma !== null) {
                isGyroActive = true;
                
                // Normalize gamma to acceleration value
                // Dead zone to prevent jitter when device is held still
                const deadZone = 5;      // Degrees of no movement
                const activeRange = 30;  // Degrees for max acceleration
                
                let normalizedTilt = 0;
                
                if (Math.abs(gamma) > deadZone) {
                    // Map to -1 to 1, clamping at activeRange degrees
                    normalizedTilt = Math.max(-1, Math.min(1, 
                        (gamma - Math.sign(gamma) * deadZone) / activeRange
                    ));
                }
                
                // Apply acceleration based on tilt
                // Tilt right ‚Üí positive acceleration ‚Üí move right
                // Tilt left ‚Üí negative acceleration ‚Üí move left
                const acceleration = normalizedTilt * 0.02; // Adjust for sensitivity
                velocity += acceleration;
                
                // Apply friction to prevent infinite acceleration
                velocity *= 0.95;
                
                // Clamp velocity to prevent too-fast movement
                velocity = Math.max(-0.1, Math.min(0.1, velocity));
                
                // Update target position with velocity
                targetX += velocity;
                
                // Clamp target position to bounds
                targetX = Math.max(-1, Math.min(1, targetX));
            }
        }

        // Smooth animation loop
        function animate() {
            // Smooth interpolation toward target
            // Slightly faster smoothing for gyro to feel more responsive
            const smoothing = isGyroActive ? 0.08 : 0.05;
            currentX += (targetX - currentX) * smoothing;

            parallaxElements.forEach(el => {
                const speed = parseFloat(el.dataset.speed);
                const movement = currentX * 50 * speed; // Max 50px movement
                
                // Get existing transform
                const currentTransform = el.style.transform || getComputedStyle(el).transform;
                
                // Apply parallax while preserving other transforms
                if (currentTransform && currentTransform !== 'none') {
                    // Remove any existing translateX and add new one
                    const withoutTranslateX = currentTransform.replace(/translateX\([^)]+\)\s*/g, '');
                    el.style.transform = `translateX(${movement}px) ${withoutTranslateX}`;
                } else {
                    el.style.transform = `translateX(${movement}px)`;
                }
            });

            rafId = requestAnimationFrame(animate);
        }

        // Start animation
        animate();

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (rafId) cancelAnimationFrame(rafId);
            window.removeEventListener('deviceorientation', handleOrientation);
        });

        // Debug mode (add ?debug to URL to see values)
        if (window.location.search.includes('debug')) {
            const debugDiv = document.createElement('div');
            debugDiv.style.cssText = 'position:fixed;top:10px;left:10px;background:rgba(0,0,0,0.8);color:#0f0;padding:15px;font-family:monospace;z-index:9999;font-size:11px;border-radius:5px;min-width:200px;';
            document.body.appendChild(debugDiv);
            
            setInterval(() => {
                debugDiv.innerHTML = `
                    <div style="margin-bottom:8px;color:#fff;font-weight:bold;">Parallax Debug</div>
                    Gyro: ${isGyroActive ? '<span style="color:#0f0">‚óè</span> Active' : '<span style="color:#f00">‚óè</span> Inactive'}<br>
                    Target: ${targetX.toFixed(3)}<br>
                    Current: ${currentX.toFixed(3)}<br>
                    Velocity: ${velocity.toFixed(4)}<br>
                    Mobile: ${isMobile ? 'Yes' : 'No'}
                `;
            }, 100);
        }
    </script>
</body>
</html>